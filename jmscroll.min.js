(function(a){a.jmscroll={defaults:{autoTrigger:!0,maxPages:5,loadingHtml:"",loadingSpeed:0,contentSelector:"",nextSelector:"a:last",footerSelector:".footer",footerPadding:0,callback:!1}};var g=function(b,e){function f(){b.find(".scroll-wrapper").length||b.contents().wrapAll('<div class="scroll-wrapper" />')}function k(a){a.parent().not(".scroll-wrapper,.scroll-added").addClass("scroll-next-wrapper").hide().length||a.wrap('<div class="scroll-next-wrapper" />').parent().hide()}function l(){var d=b.find(c.nextSelector).first();
c.autoTrigger?(k(d),a("body").height()<=a(window).height()&&m(),a(window).unbind(".jmscroll").bind("scroll.jmscroll",function(){return m()}),c.maxPages--):(a(window).unbind(".jmscroll"),0<c.maxPages-1?d.bind("click.jmscroll",function(){k(d);n();c.maxPages--;return!1}):a("a.nextPage").hide())}function m(){f();a(document).on("scrollstop",function(){if(0<c.maxPages&&!b.data("jmscroll").waiting&&a(window).scrollTop()+a(window).height()>a(document).height()-a(c.footerSelector).outerHeight()-c.footerPadding)return n()})}
function n(){var d=b.find("div.scroll-wrapper").first(),e=b.data("jmscroll");e.waiting=!0;d.append('<div class="scroll-added" />').children(".scroll-added").last().html('<div class="scroll-loading">'+c.loadingHtml+"</div>");return b.animate({scrollTop:d.outerHeight()},c.loadingSpeed,function(){d.find("div.scroll-added").last().load(e.nextHref,function(d,f,g){if("error"===f)return h();d=a(this).find(c.nextSelector).first();e.waiting=!1;e.nextHref=d.attr("href")?a.trim(d.attr("href")+" "+c.contentSelector):
!1;a(".scroll-next-wrapper",b).remove();(d=b.data("jmscroll"))&&d.nextHref?l():h();c.callback&&c.callback.call(this)})})}function h(){return a(window).unbind(".jmscroll").removeData("jmscroll").find(".scroll-wrapper").children().unwrap().filter(".scroll-added").children().unwrap()}var p=b.data("jmscroll"),c=a.extend({},a.jmscroll.defaults,"function"===typeof e?{callback:e}:e,p||{}),g=a.trim(b.find(c.nextSelector).first().attr("href")+" "+c.contentSelector);b.data("jmscroll",a.extend({},p,{initialized:!0,
waiting:!1,nextHref:g}));f();(function(){var b=a(c.loadingHtml).filter("img").attr("src");b&&((new Image).src=b)})();l();a.extend(b.jmscroll,{destroy:h});return b};a.fn.jmscroll=function(b){return this.each(function(){var e=a(this),f=e.data("jmscroll");f&&f.initialized||new g(e,b)})}})(jQuery);