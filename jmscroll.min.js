(function(b){b.jmscroll={defaults:{debug:!1,autoTrigger:!1,autoTriggerUntil:!1,totalPages:10,contentSelector:"",nextSelector:"a:last",footerSelector:".footer",footerPadding:0,footerVisible:!0,loadingContentDelay:1E3,progressBarSpeed:10,callback:!1}};var l=function(c,d){function g(){c.find(".scroll-wrapper").length||c.contents().wrapAll('<div class="scroll-wrapper" />')}function n(a){a.parent().not(".scroll-wrapper,.scroll-added").addClass("scroll-next-wrapper").hide().length||a.wrap('<div class="scroll-next-wrapper" />').parent().hide()}
function p(){var e=c.find(a.nextSelector).first();if(a.autoTrigger&&(!1===a.autoTriggerUntil||0<a.autoTriggerUntil-1)&&0<a.totalPages-1)n(e),l(),0<a.autoTriggerUntil&&(a.autoTriggerUntil--,f("info","Auto Triggered Pages Remaining = "+a.autoTriggerUntil)),0<a.totalPages&&(a.totalPages--,f("info","Total Pages Remaining = "+a.totalPages));else if(_$document.off("scrollstop"),!1===a.footerVisible&&b(a.footerSelector).show(),0<a.totalPages-1)e.on("click",function(){n(e);q();a.totalPages--;f("info","Total Pages Remaining = "+
a.totalPages);return!1});else f("info","Total Pages Number Reached. Calling destroy()"),b(a.nextSelector).remove(),h()}function l(){g();_$document.on("scrollstop",function(){if(!c.data("jmscroll").waiting&&_$window.scrollTop()+_$window.height()>_$document.height()-b(a.footerSelector).outerHeight()-a.footerPadding)return f("info",a.footerPadding+"px From '"+a.footerSelector+"'. Calling load()"),q()})}function q(){var e=c.find("div.scroll-wrapper").first(),k=c.data("jmscroll");k.waiting=!0;e.append('<div class="scroll-added" />').children(".scroll-added").last().html('<div class="progress-bar"><span></span></div>');
t();return c.animate({scrollTop:e.outerHeight()},a.loadingContentDelay,function(){e.find("div.scroll-added").last().load(k.nextHref,function(e,d,g){if("error"===d)return f("error","Error Status Returned From load(). Calling destroy()"),!1===a.footerVisible&&b(a.footerSelector).show(),b(".progress-bar").hide(),h();e=b(this).find(a.nextSelector).first();k.waiting=!1;k.nextHref=e.attr("href")?b.trim(e.attr("href")+" "+a.contentSelector):!1;b(".scroll-next-wrapper",c).remove();(e=c.data("jmscroll"))&&
e.nextHref?p():(f("info","No More Data. Calling destroy()"),!1===a.footerVisible&&b(a.footerSelector).show(),h());a.callback&&a.callback.call(this)})})}function t(){var e=0,c=setInterval(function(){e++;var d=e%100*b(".progress-bar").width()/100;b(".progress-bar").find("span").animate({width:d},a.progressBarSpeed);e*a.progressBarSpeed>a.loadingContentDelay&&clearInterval(c)},a.progressBarSpeed)}function h(){return _$document.removeData("jmscroll").find(".scroll-wrapper").children().unwrap().filter(".scroll-added").children().unwrap()}
function f(b){if(a.debug&&"object"===typeof console&&("object"===typeof b||"function"===typeof console[b]))if("object"===typeof b){var c=[],d;for(d in b)"function"===typeof console[d]?(c=m[d].length?m[d]:[m[d]],console[d].apply(console,c)):console.log.apply(console,c)}else console[b].apply(console,Array.prototype.slice.call(arguments,1))}var r=c.data("jmscroll"),a=b.extend({},b.jmscroll.defaults,"function"===typeof d?{callback:d}:d,r||{}),u=b.trim(c.find(a.nextSelector).first().attr("href")+" "+a.contentSelector);
_$window=b(window);_$document=b(document);_$body=b("body");c.data("jmscroll",b.extend({},r,{initialized:!0,waiting:!1,nextHref:u}));!0===a.autoTrigger&&!1===a.footerVisible&&b(a.footerSelector).hide();g();p();b.extend(c.jmscroll,{destroy:h});return c};b.fn.jmscroll=function(c){return this.each(function(){var d=b(this),g=d.data("jmscroll");g&&g.initialized||new l(d,c)})}})(jQuery);