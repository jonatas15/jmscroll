(function(d){d.jmscroll={defaults:{debug:!1,autoTrigger:!1,autoTriggerUntil:!1,totalPages:10,contentSelector:"",nextSelector:"a:last",footerSelector:".footer",footerPadding:0,loadingContentDelay:1E3,progressBarSpeed:10,callback:!1}};var l=function(b,e){function g(){b.find(".scroll-wrapper").length||b.contents().wrapAll('<div class="scroll-wrapper" />')}function n(a){a.parent().not(".scroll-wrapper,.scroll-added").addClass("scroll-next-wrapper").hide().length||a.wrap('<div class="scroll-next-wrapper" />').parent().hide()}
function p(){var c=b.find(a.nextSelector).first();if(a.autoTrigger&&(!1===a.autoTriggerUntil||0<a.autoTriggerUntil-1))n(c),l(),0<a.autoTriggerUntil&&(a.autoTriggerUntil--,f("info","Auto Triggered Pages Remaining = "+a.autoTriggerUntil)),0<a.totalPages&&(a.totalPages--,f("info","Total Pages Remaining = "+a.totalPages));else if(_$document.off("scrollstop"),0<a.totalPages-1)c.on("click",function(){n(c);q();a.totalPages--;f("info","Total Pages Remaining = "+a.totalPages);return!1});else f("info","Total Pages Number Reached. Calling destroy()"),
d(a.nextSelector).remove(),h()}function l(){g();_$document.on("scrollstop",function(){if(!b.data("jmscroll").waiting&&_$window.scrollTop()+_$window.height()>_$document.height()-d(a.footerSelector).outerHeight()-a.footerPadding)return f("info",a.footerPadding+"px From '"+a.footerSelector+"'. Calling load()"),q()})}function q(){var c=b.find("div.scroll-wrapper").first(),k=b.data("jmscroll");k.waiting=!0;c.append('<div class="scroll-added" />').children(".scroll-added").last().html('<div class="progress-bar"><span></span></div>');
t();return b.animate({scrollTop:c.outerHeight()},a.loadingContentDelay,function(){c.find("div.scroll-added").last().load(k.nextHref,function(c,e,g){if("error"===e)return f("error","Error Status Returned From load(). Calling destroy()"),h();c=d(this).find(a.nextSelector).first();k.waiting=!1;k.nextHref=c.attr("href")?d.trim(c.attr("href")+" "+a.contentSelector):!1;d(".scroll-next-wrapper",b).remove();(c=b.data("jmscroll"))&&c.nextHref?p():(f("info","No More Data. Calling destroy()"),h());a.callback&&
a.callback.call(this)})})}function t(){var c=0,b=setInterval(function(){c++;var e=c%100*d(".progress-bar").width()/100;d(".progress-bar").find("span").animate({width:e},a.progressBarSpeed);c*a.progressBarSpeed>a.loadingContentDelay&&clearInterval(b)},a.progressBarSpeed)}function h(){return _$document.removeData("jmscroll").find(".scroll-wrapper").children().unwrap().filter(".scroll-added").children().unwrap()}function f(c){if(a.debug&&"object"===typeof console&&("object"===typeof c||"function"===
typeof console[c]))if("object"===typeof c){var d=[],b;for(b in c)"function"===typeof console[b]?(d=m[b].length?m[b]:[m[b]],console[b].apply(console,d)):console.log.apply(console,d)}else console[c].apply(console,Array.prototype.slice.call(arguments,1))}var r=b.data("jmscroll"),a=d.extend({},d.jmscroll.defaults,"function"===typeof e?{callback:e}:e,r||{}),u=d.trim(b.find(a.nextSelector).first().attr("href")+" "+a.contentSelector);_$window=d(window);_$document=d(document);_$body=d("body");b.data("jmscroll",
d.extend({},r,{initialized:!0,waiting:!1,nextHref:u}));g();p();d.extend(b.jmscroll,{destroy:h});return b};d.fn.jmscroll=function(b){return this.each(function(){var e=d(this),g=e.data("jmscroll");g&&g.initialized||new l(e,b)})}})(jQuery);