(function(c){c.jmscroll={defaults:{debug:!1,autoTrigger:!1,autoTriggerUntil:!1,totalPages:10,contentSelector:"",nextSelector:"a:last",footerSelector:".footer",footerPadding:0,footerVisible:!0,loadingContentDelay:1E3,progressBarSpeed:10,callback:!1}};var l=function(b,e){function g(){b.find(".scroll-wrapper").length||b.contents().wrapAll('<div class="scroll-wrapper" />')}function n(a){a.parent().not(".scroll-wrapper,.scroll-added").addClass("scroll-next-wrapper").hide().length||a.wrap('<div class="scroll-next-wrapper" />').parent().hide()}
function p(){var d=b.find(a.nextSelector).first();if(a.autoTrigger&&(!1===a.autoTriggerUntil||0<a.autoTriggerUntil-1)&&0<a.totalPages-1)n(d),l(),0<a.autoTriggerUntil&&(a.autoTriggerUntil--,f("info","Auto Triggered Pages Remaining = "+a.autoTriggerUntil)),0<a.totalPages&&(a.totalPages--,f("info","Total Pages Remaining = "+a.totalPages));else if(_$document.off("scrollstop"),!1===a.footerVisible&&c(a.footerSelector).show(),0<a.totalPages-1)d.on("click",function(){n(d);q();a.totalPages--;f("info","Total Pages Remaining = "+
a.totalPages);return!1});else f("info","Total Pages Number Reached. Calling destroy()"),c(a.nextSelector).remove(),h()}function l(){g();_$document.on("scrollstop",function(){if(!b.data("jmscroll").waiting&&_$window.scrollTop()+_$window.height()>_$document.height()-c(a.footerSelector).outerHeight()-a.footerPadding)return f("info",a.footerPadding+"px From '"+a.footerSelector+"'. Calling load()"),q()})}function q(){var d=b.find("div.scroll-wrapper").first(),k=b.data("jmscroll");k.waiting=!0;d.append('<div class="scroll-added" />').children(".scroll-added").last().html('<div class="progress-bar"><span></span></div>');
t();return b.animate({scrollTop:d.outerHeight()},a.loadingContentDelay,function(){d.find("div.scroll-added").last().load(k.nextHref,function(d,e,g){if("error"===e)return f("error","Error Status Returned From load(). Calling destroy()"),h();d=c(this).find(a.nextSelector).first();k.waiting=!1;k.nextHref=d.attr("href")?c.trim(d.attr("href")+" "+a.contentSelector):!1;c(".scroll-next-wrapper",b).remove();(d=b.data("jmscroll"))&&d.nextHref?p():(f("info","No More Data. Calling destroy()"),h());a.callback&&
a.callback.call(this)})})}function t(){var d=0,b=setInterval(function(){d++;var e=d%100*c(".progress-bar").width()/100;c(".progress-bar").find("span").animate({width:e},a.progressBarSpeed);d*a.progressBarSpeed>a.loadingContentDelay&&clearInterval(b)},a.progressBarSpeed)}function h(){return _$document.removeData("jmscroll").find(".scroll-wrapper").children().unwrap().filter(".scroll-added").children().unwrap()}function f(d){if(a.debug&&"object"===typeof console&&("object"===typeof d||"function"===
typeof console[d]))if("object"===typeof d){var c=[],b;for(b in d)"function"===typeof console[b]?(c=m[b].length?m[b]:[m[b]],console[b].apply(console,c)):console.log.apply(console,c)}else console[d].apply(console,Array.prototype.slice.call(arguments,1))}var r=b.data("jmscroll"),a=c.extend({},c.jmscroll.defaults,"function"===typeof e?{callback:e}:e,r||{}),u=c.trim(b.find(a.nextSelector).first().attr("href")+" "+a.contentSelector);_$window=c(window);_$document=c(document);_$body=c("body");b.data("jmscroll",
c.extend({},r,{initialized:!0,waiting:!1,nextHref:u}));!0===a.autoTrigger&&!1===a.footerVisible&&c(a.footerSelector).hide();g();p();c.extend(b.jmscroll,{destroy:h});return b};c.fn.jmscroll=function(b){return this.each(function(){var e=c(this),g=e.data("jmscroll");g&&g.initialized||new l(e,b)})}})(jQuery);