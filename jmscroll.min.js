(function(a){a.jmscroll={defaults:{autoTrigger:!0,maxPages:5,contentSelector:"",nextSelector:"a:last",footerSelector:".footer",footerPadding:0,loadingContentDelay:1E3,progressBarSpeed:10,callback:!1}};var g=function(c,e){function f(){c.find(".scroll-wrapper").length||c.contents().wrapAll('<div class="scroll-wrapper" />')}function k(a){a.parent().not(".scroll-wrapper,.scroll-added").addClass("scroll-next-wrapper").hide().length||a.wrap('<div class="scroll-next-wrapper" />').parent().hide()}function l(){var d=
c.find(b.nextSelector).first();b.autoTrigger?(k(d),a("body").height()<=a(window).height()&&m(),a(window).unbind(".jmscroll").bind("scroll.jmscroll",function(){return m()}),b.maxPages--):(a(window).unbind(".jmscroll"),0<b.maxPages-1?d.bind("click.jmscroll",function(){k(d);n();b.maxPages--;return!1}):a("a.nextPage").hide())}function m(){f();a(document).on("scrollstop",function(){if(0<b.maxPages&&!c.data("jmscroll").waiting&&a(window).scrollTop()+a(window).height()>a(document).height()-a(b.footerSelector).outerHeight()-
b.footerPadding)return n()})}function n(){var d=c.find("div.scroll-wrapper").first(),e=c.data("jmscroll");e.waiting=!0;d.append('<div class="scroll-added" />').children(".scroll-added").last().html('<div class="progress-bar"><span></span></div>');g();return c.animate({scrollTop:d.outerHeight()},b.loadingContentDelay,function(){d.find("div.scroll-added").last().load(e.nextHref,function(d,f,g){if("error"===f)return h();d=a(this).find(b.nextSelector).first();e.waiting=!1;e.nextHref=d.attr("href")?a.trim(d.attr("href")+
" "+b.contentSelector):!1;a(".scroll-next-wrapper",c).remove();(d=c.data("jmscroll"))&&d.nextHref?l():h();b.callback&&b.callback.call(this)})})}function g(){var d=0,c=setInterval(function(){d++;var e=d%100*a(".progress-bar").width()/100;a(".progress-bar").find("span").animate({width:e},b.progressBarSpeed);d*b.progressBarSpeed>b.loadingContentDelay&&clearInterval(c)},b.progressBarSpeed)}function h(){return a(window).unbind(".jmscroll").removeData("jmscroll").find(".scroll-wrapper").children().unwrap().filter(".scroll-added").children().unwrap()}
var p=c.data("jmscroll"),b=a.extend({},a.jmscroll.defaults,"function"===typeof e?{callback:e}:e,p||{}),q=a.trim(c.find(b.nextSelector).first().attr("href")+" "+b.contentSelector);c.data("jmscroll",a.extend({},p,{initialized:!0,waiting:!1,nextHref:q}));f();l();a.extend(c.jmscroll,{destroy:h});return c};a.fn.jmscroll=function(c){return this.each(function(){var e=a(this),f=e.data("jmscroll");f&&f.initialized||new g(e,c)})}})(jQuery);